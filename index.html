<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calculadora de peso de bobinas - Variante 1</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2b2b2b">
  <link rel="icon" href="icon-192.png">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:16px}
    label{display:block;margin-top:12px}
    select,input,button{padding:8px;margin-top:6px;width:100%;max-width:420px}
    canvas{max-width:100%;margin-top:20px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Calculadora de peso de bobinas - Variante 1</h1>

  <label for="paperType">Tipo de papel</label>
  <select id="paperType">
    <option value="offset_80" data-thickness="0.11">Papel offset - 80 g/m2 (0.11 mm)</option>
    <option value="offset_100" data-thickness="0.12">Papel offset - 100 g/m2 (0.12 mm)</option>
    <option value="offset_120" data-thickness="0.15">Papel offset - 120 g/m2 (0.15 mm)</option>

    <option value="couche_115" data-thickness="0.11">Papel couche - 115 g/m2 (0.11 mm)</option>
    <option value="couche_130" data-thickness="0.13">Papel couche - 130 g/m2 (0.13 mm)</option>
    <option value="couche_150" data-thickness="0.16">Papel couche - 150 g/m2 (0.16 mm)</option>
    <option value="couche_170" data-thickness="0.19">Papel couche - 170 g/m2 (0.19 mm)</option>

    <option value="kraft_70" data-thickness="0.08">Papel kraft - 70 g/m2 (0.08 mm)</option>
    <option value="kraft_80" data-thickness="0.10">Papel kraft - 80 g/m2 (0.10 mm)</option>
    <option value="kraft_90" data-thickness="0.11">Papel kraft - 90 g/m2 (0.11 mm)</option>

    <option value="thermal_48" data-thickness="0.06">Papel termico - 48 g/m2 (0.06 mm)</option>
    <option value="thermal_55" data-thickness="0.07">Papel termico - 55 g/m2 (0.07 mm)</option>

    <option value="recycled_80" data-thickness="0.11">Papel reciclado - 80 g/m2 (0.11 mm)</option>
    <option value="recycled_120" data-thickness="0.15">Papel reciclado - 120 g/m2 (0.15 mm)</option>

    <option value="cardstock_200" data-thickness="0.24">Cartulina / carton fino - 200 g/m2 (0.24 mm)</option>
    <option value="cardstock_300" data-thickness="0.45">Carton grueso - 300 g/m2 (0.45 mm)</option>

    <option value="custom">Ingresar espesor manual...</option>
  </select>

  <div id="manualThickness" style="display:none;max-width:420px">
    <label for="thicknessInput">Espesor (mm)</label>
    <input id="thicknessInput" type="number" step="0.001" min="0" placeholder="Ej: 0.11">
  </div>

  <label for="gramaje">Gramaje (g/m2)</label>
  <input id="gramaje" type="number" step="1" min="0" placeholder="Ej: 80">

  <label for="width">Ancho (mm)</label>
  <input id="width" type="number" step="0.1" placeholder="Ej: 1000">

  <label for="outerDiameter">Diámetro exterior (mm)</label>
  <input id="outerDiameter" type="number" step="0.1" placeholder="Ej: 600">

  <label for="coreDiameter">Diámetro del mandril (mm)</label>
  <input id="coreDiameter" type="number" step="0.1" placeholder="Ej: 76">

  <button id="calc">Calcular peso</button>
  <button id="resetChart" style="margin-top:10px;">Resetear gráfico</button>

  <h2 id="result">Peso aproximado: —</h2>

  <canvas id="weightChart" height="250"></canvas>

  <script>
    const paperSelect = document.getElementById('paperType');
    const manualDiv = document.getElementById('manualThickness');
    const thicknessInput = document.getElementById('thicknessInput');
    const ctx = document.getElementById('weightChart').getContext('2d');

    let chart = new Chart(ctx, {
      type: 'bar',
      data: { labels: [], datasets: [{label: 'Peso (kg)', data: [], backgroundColor: 'rgba(54,162,235,0.6)'}] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    paperSelect.addEventListener('change', ()=>{
      manualDiv.style.display = paperSelect.value === 'custom' ? 'block' : 'none';
    });

    document.getElementById('calc').addEventListener('click', ()=>{
      const width = parseFloat(document.getElementById('width').value) || 0;
      const D = parseFloat(document.getElementById('outerDiameter').value) || 0;
      const d = parseFloat(document.getElementById('coreDiameter').value) || 0;
      const gramaje = parseFloat(document.getElementById('gramaje').value) || 0;

      let thicknessMm = 0;
      let paperName = paperSelect.selectedOptions[0].text;
      if(paperSelect.value === 'custom'){
        thicknessMm = parseFloat(thicknessInput.value) || 0;
        paperName = "Espesor manual";
      } else {
        thicknessMm = parseFloat(paperSelect.selectedOptions[0].getAttribute('data-thickness')) || 0;
      }

      // Cálculo del peso usando gramaje
      const peso = Math.PI * (Math.pow(D,2) - Math.pow(d,2)) / (4 * thicknessMm) * width * gramaje / 1000;
      document.getElementById('result').innerText = 'Peso aproximado: ' + peso.toFixed(2) + ' kg';

      // Actualizar gráfico
      chart.data.labels.push(paperName);
      chart.data.datasets[0].data.push(peso.toFixed(2));
      chart.update();
    });

    document.getElementById('resetChart').addEventListener('click', ()=>{
      chart.data.labels = [];
      chart.data.datasets[0].data = [];
      chart.update();
      document.getElementById('result').innerText = 'Peso aproximado: —';
    });

    if(paperSelect.value !== 'custom') manualDiv.style.display = 'none';
  </script>

  <script>
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
  </script>
</body>
</html>